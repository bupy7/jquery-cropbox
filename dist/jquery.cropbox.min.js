"use strict";!function(t){var i="mousedown",n="mousemove",e="mouseup",o="mousewheel",h="resize",u="change",s="load",l="click",a=null,c=null,r=null,f=null,d=null,p=null,g={},m={},w={},v=new Image,b=t(document),Y=t(window),X=1,x=0,y=null,D=null,k=null,H=null,I=null,P=null,W=null,O={},R=[{width:200,height:200,minWidth:200,minHeight:200,maxWidth:350,maxHeight:350}],S=[],z={init:function(i){a=t(this),D=t(i.selectors.inputFile),P=t(i.selectors.inputInfo),k=t(i.selectors.btnReset),H=t(i.selectors.btnCrop),I=t(i.selectors.resultContainer),R=i.variants||R,O=i.imageOptions||O,S=i.messages||S,"undefined"!=typeof i.selectors.messageBlock&&(W=t(i.selectors.messageBlock)),Yt(),C(),gt(),bt(),J()}},C=function(){r=a.find(".image-cropbox"),c=a.find(".frame-cropbox"),f=a.find(".workarea-cropbox"),d=a.find(".membrane-cropbox"),p=a.find(".resize-cropbox")},J=function(){c.on(i,L),c.on(n,U),b.on(e,M),p.on(i,Q),b.on(n,V),b.on(e,q),d.on(i,E),d.on(n,G),d.on(e,K),d.on(o,tt),Y.on(h,_),D.on(u,N),H.on(l,j),k.on(l,ft)},N=function(){var i=new FileReader;i.readAsDataURL(this.files[0]),t(i).one(s,$)},j=function(){var i=c.position().left-r.position().left,n=c.position().top-r.position().top,e=c.width(),o=c.height(),h=t("<canvas/>").attr({width:e,height:o})[0],u=null;h.getContext("2d").drawImage(r[0],0,0,v.width,v.height,-i,-n,r.width(),r.height()),u=h.toDataURL("image/png"),rt({sWidth:v.width,sHeight:v.height,x:i,y:n,dWidth:r.width(),dHeight:r.height(),ratio:X,width:e,height:o,image:u}),xt(t("<img>",t.extend(O,{src:u}))),at()&&wt()},A=function(){var t=lt(),i=f.width()/2-t.width/2,n=f.height()/2-t.height/2;c.css({width:t.width,height:t.height,backgroundImage:'url("'+v.src+'")'}),B(i,n)},B=function(t,i){var n=r.position().left,e=r.position().top,o=n-t,h=e-i;o>0?(o=0,t=n):r.width()+n<t+c.width()&&(o=c.width()-r.width(),t=n+r.width()-c.width()),h>0?(h=0,i=e):r.height()+e<i+c.height()&&(h=c.height()-r.height(),i=e+r.height()-c.height()),c.css({left:t,top:i,backgroundPosition:o+"px "+h+"px"})},F=function(t,i){var n=r.position().left,e=r.position().top,o=c.position().left,h=c.position().top,u=c.width(),s=c.height(),l=lt(),a=l.maxWidth,f=l.maxHeight,d=l.minWidth,p=l.minHeight;t>u&&"undefined"==typeof a?a=u:u>t&&"undefined"==typeof d&&(d=u),i>s&&"undefined"==typeof f?f=s:s>i&&"undefined"==typeof p&&(p=s),t>a?t=a:d>t&&(t=d),r.width()+n<o+t&&(t=r.width()+n-o),i>f?i=f:p>i&&(i=p),r.height()+e<h+i&&(i=r.height()+e-h),c.css({width:t,height:i})},L=function(t){g.dragable=!0,g.mouseX=t.clientX,g.mouseY=t.clientY},U=function(t){if(g.dragable){var i=c.position().left,n=c.position().top,e=t.clientX-g.mouseX+i,o=t.clientY-g.mouseY+n;g.mouseX=t.clientX,g.mouseY=t.clientY,B(e,o)}},M=function(t){t.preventDefault(),t.stopPropagation(),g.dragable=!1},Q=function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),w.dragable=!0,w.mouseX=t.clientX,w.mouseY=t.clientY},V=function(t){if(w.dragable){var i=c.width(),n=c.height(),e=t.clientX-w.mouseX+i,o=t.clientY-w.mouseY+n;w.mouseX=t.clientX,w.mouseY=t.clientY,F(e,o)}},q=function(t){t.preventDefault(),t.stopPropagation(),w.dragable=!1},E=function(t){m.dragable=!0,m.mouseX=t.clientX,m.mouseY=t.clientY},G=function(t){if(m.dragable){var i=r.position().left,n=r.position().top,e=t.clientX-m.mouseX+i,o=t.clientY-m.mouseY+n;m.mouseX=t.clientX,m.mouseY=t.clientY,T(e,o),g.mouseX=t.clientX,g.mouseY=t.clientY,B(c.position().left,c.position().top)}},K=function(t){t.preventDefault(),t.stopPropagation(),m.dragable=!1},T=function(t,i){r.css({left:t,top:i})},Z=function(){var t=r.width()/2-f.width()/2,i=r.height()/2-f.height()/2;T(-t,-i)},$=function(i){t(v).one(s,function(){r.one(s,dt),r.attr("src",this.src)}),v.src=i.target.result},_=function(){ot(),Z(),A()},tt=function(t){t.deltaY>0?it():nt(),t.preventDefault?t.preventDefault():t.returnValue=!1},it=function(){X*=1.01;var t=v.width*X,i=v.height*X;et(t,i),B(c.position().left,c.position().top)},nt=function(){var t=X;X*=.99;var i=v.width*X,n=v.height*X;i>=c.width()&&n>=c.height()?(et(i,n),B(c.position().left,c.position().top)):X=t},et=function(t,i){r.css({width:t,height:i}),c.css({backgroundSize:t+"px "+i+"px"})},ot=function(){var t=lt();if(t.width>v.width||t.height>v.height){var i=t.width/v.width,n=t.height/v.height;X=i>n?i:n}else X=1;et(v.width*X,v.height*X)},ht=function(){f.fadeIn()},ut=function(){f.fadeOut()},st=function(){x=0},lt=function(){return R[x]},at=function(){return R.length<=x+1?(x=0,pt(),!1):(++x,ot(),Z(),A(),!0)},ct=function(t){P.val(JSON.stringify(t))},rt=function(t){var i=JSON.parse(P.val());i.push(t),P.val(JSON.stringify(i))},ft=function(){Xt(),ct([]),st(),ut(),gt(),bt()},dt=function(){yt(),ct([]),st(),ht(),ot(),Z(),A(),mt(),vt()},pt=function(){ut(),gt(),bt()},gt=function(){H.prop("disabled",!0)},mt=function(){H.prop("disabled",!1)},wt=function(){vt()||bt()},vt=function(){return"undefined"!=typeof S[x]&&null!==W?(W.html(S[x]).show(),!0):!1},bt=function(){null!==W&&W.hide()},Yt=function(){y=I.clone()},Xt=function(){I.html(y.html())},xt=function(t){I.append(t)},yt=function(){I.empty()};t.fn.cropbox=function(i){return z[i]?z[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error('Method "'+i+'" not exists.'):z.init.apply(this,arguments)}}(jQuery);